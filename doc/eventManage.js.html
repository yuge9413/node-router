<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: eventManage.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: eventManage.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * 事件订阅 / 发布
 * @author yuge9413.com
 */

/**
 * 事件管理
 */
class EventManage {
    constructor() {
        this.eventList = {
            // 单次事件
            once: [],
            // 全局事件
            'router-all-event': [],
            // 无绑定事件
            'router-not-event': []
        };
    }

    /**
     * 事件订阅
     * @param {string} name 事件名称
     * @param {Function} handler 回调函数
     */
    on(name, handler) {
        if (!handler || typeof handler !== 'function') {
            return new Error('Event err: event publish callback is not a function!');
        }
        this.eventList[name] = this.eventList[name] || [];
        this.eventList[name].push(handler);
    }

    /**
     * 订阅单次事件
     * @param {string} name 事件名称
     * @param {Function} handler 回调函数
     */
    once(name, handler) {
        if (!handler || typeof handler !== 'function') {
            return new Error('Event err: event publish callback is not a function!');
        }
        const onceList = this.eventList['once'] || {};
        onceList[name] = onceList[name] || [];
        onceList[name].push(handler);
        this.eventList['once'] = onceList;
    }

    /**
     * 删除事件
     * @param {string} name 事件名称
     * @param {Function} handler 回调函数
     */
    remove(name, handler) {
        const list = this.eventList[name];
        const onceList = this.eventList['once'][name];

        // 该事件不存在时
        if (!list &amp;&amp; !onceList) {
            return;
        }

        // 没有回调函数，删除所有名称为{name}的事件
        if (!handler) {
            delete this.eventList[name];
            delete this.eventList['once'][name];
            return;
        }

        const handlerStr = handler.toString();

        // 删除列表中的回调函数
        if (list &amp;&amp; list.length > 0) {
            this.eventList[name] = list.filter(item => item.toString() !== handlerStr);
        }

        // 删除单次列表中的回调函数
        if (onceList &amp;&amp; onceList.length > 0) {
            this.eventList['once'][name] = onceList.filter(item => item.toString() !== handlerStr);
        }
    }

    /**
     * 删除所有事件
     */
    removeAll() {
        this.eventList = {
            // 单次事件
            once: [],
            // 全局事件
            'router-all-event': [],
            // 无绑定事件
            'router-not-event': []
        };
    }

    /**
     * 事件发布
     * @param {string} name 事件名称
     * @param  {...any} args 回调函数参数
     */
    trigger(name, ...args) {
        const list = this.eventList[name] || [];
        const onceList = this.eventList['once'][name] || [];

        // 处理全局事件
        if (this.eventList['router-all-event']
            &amp;&amp; this.eventList['router-all-event'].length > 0) {
            this.eventList['router-all-event'].map(item => item(...args));
        }

        // 依次调用回调
        if (list &amp;&amp; list.length > 0) {
            list.map(item => item(...args));
        }

        // 依次调用只执行一次的回调
        // 执行一次后 删除事件
        if (onceList &amp;&amp; onceList.length > 0) {
            onceList.map(item => item(...args));
            return delete this.eventList['once'][name];
        }

        // 处理404
        if (list.length === 0 
            &amp;&amp; onceList.length === 0
            &amp;&amp; this.eventList['router-all-event'].length === 0) {
            this.eventList['router-not-event'].map(item => item(...args));
        }
    }
}

export default EventManage;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="EventManage.html">EventManage</a></li><li><a href="RouterManage.html">RouterManage</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Router">Router</a></li><li><a href="global.html#url">url</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Sep 05 2018 22:27:13 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
